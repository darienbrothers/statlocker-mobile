# Internationalization (i18n) System

## Overview

StatLocker uses a lightweight internationalization system that provides centralized copy management, extensible locale support, and consistent text formatting. The system is designed to be simple yet powerful, supporting the MVP's en-US locale while being ready for future international expansion.

## Features

- **Centralized Copy Management**: All user-facing text is managed through translation keys
- **en-US Locale Support**: Full support for US English as the MVP locale
- **Extensible Architecture**: Ready for additional locales without code changes
- **Text Formatting**: Built-in support for number, date, and relative time formatting
- **Pluralization**: Automatic plural form selection based on count
- **Interpolation**: Variable substitution in translation strings
- **React Integration**: Custom hook for seamless React component integration
- **TypeScript Support**: Full type safety for translation keys and values

## Quick Start

### Basic Usage

```typescript
import { useTranslation } from '@/hooks/useTranslation';

function MyComponent() {
  const { t } = useTranslation();
  
  return (
    <View>
      <Text>{t('app.name')}</Text>
      <Button>{t('common.save')}</Button>
    </View>
  );
}
```

### With Interpolation

```typescript
const { t } = useTranslation();

// Simple interpolation
const welcomeMessage = t('dashboard.welcome', { name: 'John' });
// Result: "Welcome back, John!"

// With pluralization
const goalCount = t('stats.goals', { count: 3 }, 3);
// Result: "3 goals"
```

### Formatting

```typescript
const { formatNumber, formatDate, formatCurrency } = useTranslation();

const price = formatCurrency(29.99); // "$29.99"
const date = formatDate(new Date()); // "12/25/2023"
const percentage = formatNumber(0.85, { style: 'percent' }); // "85%"
```

## Architecture

### Core Components

1. **I18nManager**: Central manager for translations and locale state
2. **Translation Store**: In-memory storage for all locale translations
3. **useTranslation Hook**: React integration layer
4. **Formatting Utilities**: Number, date, and time formatting functions

### File Structure

```
src/
├── lib/
│   ├── i18n.ts                 # Core i18n system
│   └── translations/
│       ├── en-US.ts           # English translations
│       ├── es-ES.ts           # Spanish translations (future)
│       └── fr-FR.ts           # French translations (future)
├── hooks/
│   └── useTranslation.ts      # React hook
└── components/
    └── MyComponent.tsx        # Usage example
```

## Translation Keys

### Naming Convention

Translation keys follow a hierarchical dot notation:

- `category.subcategory.key`
- `feature.action`
- `common.action`

### Categories

- **app**: Application-level strings (name, tagline)
- **auth**: Authentication flows
- **nav**: Navigation labels
- **common**: Shared actions and states
- **empty**: Empty state messages
- **error**: Error messages
- **offline**: Offline state messages
- **loading**: Loading states
- **a11y**: Accessibility labels
- **validation**: Form validation messages
- **success**: Success messages

### Examples

```typescript
// App-level
'app.name': 'StatLocker'
'app.tagline': 'Stat tracking made easy. Progress made visible.'

// Common actions
'common.save': 'Save'
'common.cancel': 'Cancel'
'common.tryAgain': 'Try Again'

// Error messages
'error.generic': 'Something went wrong. Please try again.'
'error.network': 'Please check your internet connection and try again.'

// Empty states
'empty.stats.title': 'No games yet—log your first game to unlock trends.'
'empty.stats.action': 'Log a Game'
```

## Advanced Features

### Pluralization

The system supports ICU-style pluralization:

```typescript
// Translation definition
'stats.goals': {
  message: '{{count}} goal',
  plural: {
    one: '{{count}} goal',
    other: '{{count}} goals',
  },
}

// Usage
t('stats.goals', { count: 1 }, 1); // "1 goal"
t('stats.goals', { count: 5 }, 5); // "5 goals"
```

### Context and Descriptions

Translations can include context and descriptions for translators:

```typescript
'button.submit': {
  message: 'Submit',
  description: 'Button text for form submission',
  context: 'Used in contact forms and registration'
}
```

### RTL Support

The system includes RTL (Right-to-Left) language detection:

```typescript
const { isRTL, textDirection } = useTranslation();

const styles = {
  textAlign: isRTL ? 'right' : 'left',
  direction: textDirection, // 'ltr' or 'rtl'
};
```

## Adding New Locales

### 1. Create Translation File

```typescript
// src/lib/translations/es-ES.ts
import { type Translations } from '../i18n';

export const esESTranslations: Translations = {
  'app.name': 'StatLocker',
  'common.save': 'Guardar',
  'common.cancel': 'Cancelar',
  // ... more translations
};

export default esESTranslations;
```

### 2. Update Initialization

```typescript
// In initializeI18n function
const { esESTranslations } = await import('./translations/es-ES');
i18n.loadTranslations('es-ES', esESTranslations);
```

### 3. Add Locale Type

```typescript
// Update Locale type in i18n.ts
export type Locale = 'en-US' | 'es-ES' | 'fr-FR' | 'de-DE' | 'pt-BR';
```

## Best Practices

### 1. Always Use Translation Keys

❌ **Don't:**
```typescript
<Text>Save</Text>
<Button>Cancel</Button>
```

✅ **Do:**
```typescript
<Text>{t('common.save')}</Text>
<Button>{t('common.cancel')}</Button>
```

### 2. Provide Context for Translators

```typescript
'button.delete': {
  message: 'Delete',
  description: 'Permanently removes the item',
  context: 'Destructive action button'
}
```

### 3. Use Interpolation for Dynamic Content

❌ **Don't:**
```typescript
const message = `Welcome back, ${userName}!`;
```

✅ **Do:**
```typescript
const message = t('dashboard.welcome', { name: userName });
```

### 4. Handle Pluralization Properly

❌ **Don't:**
```typescript
const text = count === 1 ? '1 goal' : `${count} goals`;
```

✅ **Do:**
```typescript
const text = t('stats.goals', { count }, count);
```

### 5. Use Semantic Keys

❌ **Don't:**
```typescript
'text1': 'Save'
'button2': 'Cancel'
```

✅ **Do:**
```typescript
'common.save': 'Save'
'common.cancel': 'Cancel'
```

## Testing

### Unit Tests

```typescript
import { t, initializeI18n } from '@/lib/i18n';

describe('i18n', () => {
  beforeAll(async () => {
    await initializeI18n();
  });

  it('should translate basic keys', () => {
    expect(t('app.name')).toBe('StatLocker');
  });

  it('should handle interpolation', () => {
    expect(t('dashboard.welcome', { name: 'John' }))
      .toBe('Welcome back, John!');
  });
});
```

### Component Tests

```typescript
import { render, screen } from '@testing-library/react-native';
import { MyComponent } from './MyComponent';

// Mock the translation hook
jest.mock('@/hooks/useTranslation', () => ({
  useTranslation: () => ({
    t: (key: string) => key, // Return key as-is for testing
  }),
}));

test('renders translated text', () => {
  render(<MyComponent />);
  expect(screen.getByText('common.save')).toBeInTheDocument();
});
```

## Performance Considerations

### Lazy Loading

Translations are loaded asynchronously to avoid blocking app startup:

```typescript
// Translations are loaded on demand
const { enUSTranslations } = await import('./translations/en-US');
```

### Memory Management

- Only active locale translations are kept in memory
- Unused locales are garbage collected
- Translation keys are interned for memory efficiency

### Bundle Size

- Each locale is a separate chunk
- Only the active locale is included in the initial bundle
- Additional locales are loaded on demand

## Troubleshooting

### Missing Translation Warning

```
Translation missing for key: some.missing.key
```

**Solution**: Add the missing key to the appropriate translation file.

### Interpolation Not Working

```typescript
// Wrong: Variables not wrapped in double braces
'message': 'Hello {name}'

// Correct: Use double braces for interpolation
'message': 'Hello {{name}}'
```

### Pluralization Issues

```typescript
// Wrong: Missing count parameter
t('stats.goals', { count: 5 }); // No plural form selected

// Correct: Include count as third parameter
t('stats.goals', { count: 5 }, 5); // Proper plural form
```

## Migration Guide

### From Hardcoded Strings

1. **Identify hardcoded strings** in components
2. **Create translation keys** following naming conventions
3. **Add translations** to en-US.ts
4. **Replace strings** with `t()` calls
5. **Test thoroughly** to ensure no regressions

### Example Migration

**Before:**
```typescript
function ErrorBoundary() {
  return (
    <View>
      <Text>Something went wrong</Text>
      <Button>Try Again</Button>
    </View>
  );
}
```

**After:**
```typescript
function ErrorBoundary() {
  const { t } = useTranslation();
  
  return (
    <View>
      <Text>{t('error.generic')}</Text>
      <Button>{t('common.tryAgain')}</Button>
    </View>
  );
}
```

## Future Enhancements

### Planned Features

1. **Locale Detection**: Automatic locale detection from device settings
2. **Translation Management**: Integration with translation management services
3. **Fallback Chains**: Multiple fallback locales for missing translations
4. **Namespace Support**: Organize translations into feature-based namespaces
5. **Hot Reloading**: Development-time translation updates without restart

### Extensibility

The system is designed to support:

- **Additional Locales**: Easy addition of new languages
- **Regional Variants**: Support for en-GB, es-MX, etc.
- **Custom Formatters**: Locale-specific number and date formatting
- **Translation Validation**: Runtime validation of translation completeness
- **A/B Testing**: Dynamic translation variants for testing

## Conclusion

The StatLocker i18n system provides a solid foundation for internationalization while maintaining simplicity for the MVP. It's designed to grow with the application's needs while ensuring consistent, maintainable, and accessible user experiences across all supported locales.